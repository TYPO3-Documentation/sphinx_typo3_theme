!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).autocomplete=t()}(this,function(){"use strict";return function(u){var l,o,s=document,d=u.container||s.createElement("div"),c=d.style,e=navigator.userAgent,t=-1!==e.indexOf("Firefox")&&-1!==e.indexOf("Mobile"),i=u.debounceWaitMs||0,r=u.preventSubmit||!1,f=u.disableAutoSelect||!1,n=t?"input":"keyup",a=[],p="",v=2,m=u.showOnFocus,g=0;if(void 0!==u.minLength&&(v=u.minLength),!u.input)throw new Error("input undefined");var h=u.input;function E(){o&&window.clearTimeout(o)}function w(){return!!d.parentNode}function L(){var e;g++,a=[],p="",l=void 0,(e=d.parentNode)&&e.removeChild(d)}function b(){for(;d.firstChild;)d.removeChild(d.firstChild);var o=function(e,t){var n=s.createElement("div");return n.textContent=e.label||"",n};u.render&&(o=u.render);var i=function(e,t){var n=s.createElement("div");return n.textContent=e,n};u.renderGroup&&(i=u.renderGroup);var r=s.createDocumentFragment(),f="#9?$";if(a.forEach(function(t){if(t.group&&t.group!==f){f=t.group;var e=i(t.group,p);e&&(e.className+=" group",r.appendChild(e))}var n=o(t,p);n&&(n.addEventListener("click",function(e){u.onSelect(t,h),L(),e.preventDefault(),e.stopPropagation()}),t===l&&(n.className+=" selected"),r.appendChild(n))}),d.appendChild(r),a.length<1){if(!u.emptyMsg)return void L();var e=s.createElement("div");e.className="empty",e.textContent=u.emptyMsg,d.appendChild(e)}d.parentNode||s.body.appendChild(d),function(){if(w()){c.height="auto",c.width=h.offsetWidth+"px";var l,a=0;e(),e(),u.customize&&l&&u.customize(h,l,d,a)}function e(){var e=s.documentElement,t=e.clientTop||s.body.clientTop||0,n=e.clientLeft||s.body.clientLeft||0,o=window.pageYOffset||e.scrollTop,i=window.pageXOffset||e.scrollLeft,r=(l=h.getBoundingClientRect()).top+h.offsetHeight+o-t,f=l.left+i-n;c.top=r+"px",c.left=f+"px",(a=window.innerHeight-(l.top+h.offsetHeight))<0&&(a=0),c.top=r+"px",c.bottom="",c.left=f+"px",c.maxHeight=a+"px"}}(),function(){var e=d.getElementsByClassName("selected");if(0<e.length){var t=e[0],n=t.previousElementSibling;if(n&&-1!==n.className.indexOf("group")&&!n.previousElementSibling&&(t=n),t.offsetTop<d.scrollTop)d.scrollTop=t.offsetTop;else{var o=t.offsetTop+t.offsetHeight,i=d.scrollTop+d.offsetHeight;i<o&&(d.scrollTop+=o-i)}}}()}function y(){w()&&b()}function x(){y()}function C(e){e.target!==d?y():e.preventDefault()}function T(e){for(var t=e.which||e.keyCode||0,n=0,o=[38,13,27,39,37,16,17,18,20,91,9];n<o.length;n++){if(t===o[n])return}112<=t&&t<=123||40===t&&w()||D(0)}function N(e){var t=e.which||e.keyCode||0;if(38===t||40===t||27===t){var n=w();if(27===t)L();else{if(!n||a.length<1)return;(38===t?function(){if(a.length<1)l=void 0;else if(l===a[0])l=a[a.length-1];else for(var e=a.length-1;0<e;e--)if(l===a[e]||1===e){l=a[e-1];break}}:function(){if(a.length<1&&(l=void 0),l&&l!==a[a.length-1]){for(var e=0;e<a.length-1;e++)if(l===a[e]){l=a[e+1];break}}else l=a[0]})(),b()}return e.preventDefault(),void(n&&e.stopPropagation())}13===t&&(l&&(u.onSelect(l,h),L()),r&&e.preventDefault())}function k(){m&&D(1)}function D(e){var t=++g,n=h.value;n.length>=v||1===e?(E(),o=window.setTimeout(function(){u.fetch(n,function(e){g===t&&e&&(p=n,l=(a=e).length<1||f?void 0:a[0],b())},e)},0===e?i:0)):L()}function H(){setTimeout(function(){s.activeElement!==h&&L()},200)}return d.className="autocomplete "+(u.className||""),c.position="absolute",d.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault()}),d.addEventListener("focus",function(){return h.focus()}),h.addEventListener("keydown",N),h.addEventListener(n,T),h.addEventListener("blur",H),h.addEventListener("focus",k),window.addEventListener("resize",x),s.addEventListener("scroll",C,!0),{destroy:function(){h.removeEventListener("focus",k),h.removeEventListener("keydown",N),h.removeEventListener(n,T),h.removeEventListener("blur",H),window.removeEventListener("resize",x),s.removeEventListener("scroll",C,!0),E(),L()}}}});